---
import type { ContainerProps } from '../../types/container.types';

const props = Astro.props as ContainerProps;
const ContainerTag = props.htmlTag ?? 'section';
const containerWidthType = props.containerWidthType ?? 'full';
const contentWidthType = props.contentWidthType ?? 'boxed';
const contentBoxWidth = props.contentBoxWidth ?? 'max-w-[var(--container-max-width)]';
const widthClass = props.width ?? '';
const minHeightClass = props.minHeight ?? '';
const items = props.items ?? [];
const equalHeight = props.equalHeight ?? false;
const overflow = props.overflow ?? undefined;
const containerClassName = props.containerClassName ?? props.containerClass ?? '';
const contentClassName = props.contentClassName ?? props.contentClass ?? '';

const backgroundClass = props.background?.class ?? '';
const backgroundImage = props.background?.image ?? '';
const backgroundVideo = props.background?.video ?? '';
const backgroundAttachment = props.background?.attachment ?? 'scroll';

let containerClass = backgroundClass ? backgroundClass + ' ' : '';
if (containerWidthType === 'boxed') {
  containerClass += 'mx-auto max-w-[var(--container-max-width)] ';
} else if (containerWidthType === 'custom') {
  containerClass += 'mx-auto ';
}
if (widthClass) {
  containerClass += `${widthClass} `;
}
if (minHeightClass) {
  containerClass += `${minHeightClass} `;
}
if (overflow) {
  containerClass += ` overflow-${overflow}`;
}
if (containerClassName) {
  containerClass += containerClassName;
}

// Build inline styles for background
let containerStyle = 'position:relative;';
if (backgroundImage && !Astro.slots.background) {
  containerStyle += `background-image:url('${backgroundImage}');`;
  containerStyle += `background-attachment:${backgroundAttachment};`;
  if (!backgroundClass.includes('bg-')) {
    containerStyle += 'background-size:cover;background-position:center;';
  }
}

let contentClass = 'w-full';
if (containerWidthType === 'full') {
  if (contentWidthType === 'boxed') {
    contentClass += ` ${contentBoxWidth} mx-auto`;
  } else if (contentWidthType === 'full') {
    contentClass += ' w-full';
  }
}
if (contentClassName) {
  contentClass += ` ${contentClassName}`;
}
if (equalHeight) {
  contentClass += ' items-stretch';
}
---

<ContainerTag class={containerClass.trim()} style={containerStyle}>
  {
    Astro.slots.background ? (
      <slot name="background" />
    ) : backgroundVideo ? (
      <video
        class="absolute z-0 inset-0 w-full h-full object-cover"
        autoplay
        loop
        muted
        playsinline
        aria-hidden="true"
      >
        <source src={backgroundVideo} type="video/mp4" />
      </video>
    ) : null
  }
  <div class={contentClass.trim()} style="position:relative; z-index:1;">
    {
      items && items.length > 0 ? (
        items.map((item) => <div class={item.class} id={item.id} set:html={item.content} />)
      ) : (
        <slot />
      )
    }
  </div>
</ContainerTag>
