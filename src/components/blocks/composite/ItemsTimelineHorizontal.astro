---
import type { ItemsTimelineHorizontalProps } from '~/types/itemstimelinehorizontal.types';
import type { ItemProps } from '~/types/item.types';
import { cn } from '~/utils/styles';
import Item from '~/components/blocks/composite/Item.astro';
import merge from 'lodash.merge';

type Props = ItemsTimelineHorizontalProps;

const {
  items = [],
  connectorStyle = 'solid',
  air = 'normal',
  class: className = '',
  defaultItemConfig,
} = Astro.props;

// Spacing applied as margin-right on entire item wrapper (except last)
const spacingSettings = {
  none: '',
  tight: 'px-3 md:px-4 lg:px-6',
  normal: 'px-4 md:px-6 lg:px-8',
  loose: 'px-6 md:px-8 lg:px-12',
} as const;

const defaultTimelineClass = 'relative flex flex-row items-start';

// Merged classes
const timelineClass = cn(defaultTimelineClass, className);
---

<div class={timelineClass}>
  {
    items.map((item: ItemProps, index: number) => {
      const mergedItem = merge(
        {},
        defaultItemConfig || {},
        { contentClass: spacingSettings[air] },
        item
      );
      // const mergedItem = merge({}, defaultItemConfig, item);
      const isLast = index === items.length - 1;
      const isFirst = index === 0;

      return (
        <Item
          {...mergedItem}
          layout="vertical"
          showConnectorLeft={!isFirst}
          showConnectorRight={!isLast}
          connectorStyle={connectorStyle}
        />
      );
    })
  }
</div>
